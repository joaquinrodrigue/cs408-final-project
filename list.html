<!doctype html>

<html lang="en">

<head>
  <meta charset="utf-8">
  <title>View Sets</title>
  <meta name="description" content="Based on the dead Google Sets.">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <main>
        <article id="listpage">
            <p tabindex="0" class="bluebutton"><a href="index.html">Back</a></p>

            <form id="filters">
                <div title="Set Name" id="setname">
                    <label for="searchname">Set Name</label>
                    <input id="searchname" name="searchname" type="text" placeholder="Colors">
                </div>

                <div title="Sort By" id="sortby">
                    <label for="sort">Sort By</label>
                    <select id="sort">
                        <option value="name">Name</option>
                        <option value="words">Word Number</option>
                    </select>
                </div>

                <div title="Sort Order" id="sortorder">
                    <label for="sortorder">Descending?</label>
                    <input id="sortorder" type="checkbox">
                </div>

                <div title="Search Words" id="searchwords">
                    <label for="searchwords">Search Words</label>
                    <textarea id="searchwords" rows="5" placeholder="Add words separated by commas, Ex: Red, green, BLUE, Yellow"></textarea>
                </div>
            </form>

            <button id="searchthelist" class="greenbutton">Search</button>
        </article>

        <article>
            <table id="data">
                <!-- nothing... -->
            </table>
        </article>
    </main>

    <script src="js/main.js"></script>
    <script>
        // Delete an item
        const deleteTheThing = async (event) => {
            console.log(event);
            let id = event.target.id;
            console.log(id);
            const json = await deleteSet(id);

            if (json) {
                window.location = 'list.html';
            }
        }
        const dataTable = document.getElementById('data');

        // Search and show the table
        const search = async (event) => {
            if (event) event.preventDefault();
            const json = await searchAllSets();

            if (!json) {
                alert("Something went wrong, please try again later!");
                return;
            }

            let theTable = 
            `<tbody>
                <tr>
                    <th>Set Name</th>
                    <th>Set Words</th>
                    <th>Actions</th>
                </tr>`;
            json.forEach(element => {
                theTable += 
                `<tr>
                    <td>${element.name}</td>
                    <td>${element.words}</td>
                    <td><button id=${element.id} class="deletebutton">Delete</button></td>
                </tr>`;
            });
            theTable += `</tbody>`;
            dataTable.innerHTML = theTable;

            let deleteButtons = document.getElementsByClassName("deletebutton");
            for (let i = 0; i < deleteButtons.length; i++) {
                deleteButtons.item(i).addEventListener('click', deleteTheThing);
            }
        }

        // Add listeners and search on load
        window.onload = () => {
            const searchButton = document.getElementById('searchthelist');

            searchButton.addEventListener('click', search);
            search();
        }
    </script>
</body>

</html>